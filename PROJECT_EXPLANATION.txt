# Recipe Sharing Platform - Detailed Project Explanation

## ðŸ“‹ Table of Contents
1. [Project Overview](#project-overview)
2. [Project Structure](#project-structure)
3. [Database Models (5+ Models)](#database-models)
4. [File Upload System (Images) - DETAILED](#file-upload-system)
5. [CRUD Operations](#crud-operations)
6. [Authentication System](#authentication-system)
7. [Signals](#signals)
8. [Forms (ModelForms)](#forms)
9. [Testing](#testing)
10. [Management Commands](#management-commands)

---

## ðŸŽ¯ Project Overview

This is a **Django web application** where users can:
- Register and login with email (not username)
- Create, view, edit, and delete recipes
- Upload recipe images
- Comment on recipes
- Rate recipes (1-5 stars)
- Add recipes to favorites
- Browse recipes by categories

---

## ðŸ“ Project Structure

```
final_project/
â”œâ”€â”€ config/              # Main Django project settings
â”‚   â”œâ”€â”€ settings.py     # All configurations (database, apps, etc.)
â”‚   â”œâ”€â”€ urls.py         # Main URL routing
â”‚   â””â”€â”€ wsgi.py         # Web server configuration
â”‚
â”œâ”€â”€ users/              # User authentication app
â”‚   â”œâ”€â”€ models.py       # User and Profile models
â”‚   â”œâ”€â”€ views.py        # Login, register, profile views
â”‚   â”œâ”€â”€ forms.py        # Registration and profile forms
â”‚   â”œâ”€â”€ urls.py         # User-related URLs
â”‚   â”œâ”€â”€ signals.py      # Auto-create profile when user registers
â”‚   â””â”€â”€ tests.py        # Tests for users
â”‚
â”œâ”€â”€ recipes/            # Main recipes app
â”‚   â”œâ”€â”€ models.py       # Recipe, Category, Comment, Rating models
â”‚   â”œâ”€â”€ views.py        # All recipe views (create, read, update, delete)
â”‚   â”œâ”€â”€ forms.py        # Recipe form for creating/editing
â”‚   â”œâ”€â”€ urls.py         # Recipe URLs
â”‚   â”œâ”€â”€ signals.py      # Logging when recipes are created
â”‚   â”œâ”€â”€ tests.py        # Tests for recipes
â”‚   â””â”€â”€ management/     # Custom commands
â”‚       â””â”€â”€ commands/
â”‚           â”œâ”€â”€ create_categories.py
â”‚           â””â”€â”€ create_sample_recipes.py
â”‚
â”œâ”€â”€ templates/          # HTML templates
â”‚   â”œâ”€â”€ base.html       # Base template (navbar, footer)
â”‚   â”œâ”€â”€ users/          # User templates (login, register, profile)
â”‚   â””â”€â”€ recipes/        # Recipe templates (list, detail, form)
â”‚
â”œâ”€â”€ static/             # CSS, JavaScript, images
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ style.css   # Custom styling
â”‚
â”œâ”€â”€ media/              # User-uploaded files (created automatically)
â”‚   â”œâ”€â”€ recipes/        # Recipe images go here
â”‚   â””â”€â”€ profiles/       # Profile pictures go here
â”‚
â”œâ”€â”€ db.sqlite3          # SQLite database (created after migrations)
â”œâ”€â”€ manage.py           # Django management script
â””â”€â”€ requirements.txt    # Python packages needed
```

---

## ðŸ—„ï¸ Database Models

### 1. **User Model** (`users/models.py`)
```python
class User(AbstractUser):
    email = models.EmailField(unique=True)  # Email is the username
    username = None  # We don't use username
    USERNAME_FIELD = 'email'  # Login with email
```

**Why:** Django's default User uses username. We changed it to use email instead.

### 2. **Profile Model** (`users/models.py`)
```python
class Profile(models.Model):
    user = models.OneToOneField(User, ...)  # One user = One profile
    bio = models.TextField()
    profile_picture = models.ImageField(upload_to='profiles/')
```

**Relationship:** OneToOne - Each user has exactly one profile.

### 3. **Category Model** (`recipes/models.py`)
```python
class Category(models.Model):
    name = models.CharField(max_length=100)
    slug = models.SlugField()  # URL-friendly version of name
```

### 4. **Recipe Model** (`recipes/models.py`)
```python
class Recipe(models.Model):
    title = models.CharField(max_length=200)
    description = models.TextField()
    ingredients = models.TextField()
    instructions = models.TextField()
    cooking_time = models.PositiveIntegerField()
    difficulty_level = models.CharField(choices=[...])
    image = models.ImageField(upload_to='recipes/')  # â­ FILE UPLOAD
    author = models.ForeignKey(User, ...)  # Many recipes to one user
    category = models.ForeignKey(Category, ...)  # Many recipes to one category
    favorited_by = models.ManyToManyField(User, ...)  # Many users can favorite many recipes
```

**Relationships:**
- **ForeignKey to User:** One user can create many recipes (OneToMany)
- **ForeignKey to Category:** One category can have many recipes (OneToMany)
- **ManyToMany with User:** Many users can favorite many recipes (ManyToMany)

### 5. **Comment Model** (`recipes/models.py`)
```python
class Comment(models.Model):
    content = models.TextField()
    recipe = models.ForeignKey(Recipe, ...)  # Many comments to one recipe
    author = models.ForeignKey(User, ...)  # Many comments to one user
```

### 6. **Rating Model** (`recipes/models.py`)
```python
class Rating(models.Model):
    score = models.IntegerField(validators=[MinValueValidator(1), MaxValueValidator(5)])
    recipe = models.ForeignKey(Recipe, ...)
    user = models.ForeignKey(User, ...)
    
    class Meta:
        unique_together = ['user', 'recipe']  # One rating per user per recipe
```

---

## ðŸ“¸ FILE UPLOAD SYSTEM - DETAILED EXPLANATION

This is the **most important part** for your presentation!

### Step 1: Configure Django Settings (`config/settings.py`)

```python
# Media files (user uploaded files)
MEDIA_URL = 'media/'  # URL path to access files
MEDIA_ROOT = BASE_DIR / 'media'  # Where files are stored on disk
```

**What this does:**
- `MEDIA_URL`: When you access an image, use URL like `/media/recipes/image.jpg`
- `MEDIA_ROOT`: Files are saved to `media/` folder in your project

### Step 2: Define ImageField in Model (`recipes/models.py`)

```python
class Recipe(models.Model):
    image = models.ImageField(
        upload_to='recipes/',  # Files go to media/recipes/ folder
        blank=True,           # Not required
        null=True             # Can be empty
    )
```

**What `upload_to='recipes/'` means:**
- When user uploads an image, Django saves it to: `media/recipes/filename.jpg`
- The `media/` part comes from `MEDIA_ROOT`
- The `recipes/` part comes from `upload_to`

### Step 3: Install Pillow (Image Processing Library)

In `requirements.txt`:
```
Pillow>=10.0.0
```

**Why:** Django's `ImageField` requires Pillow to process images (resize, validate, etc.)

### Step 4: Configure URLs to Serve Media Files (`config/urls.py`)

```python
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    # ... your URLs
]

# Serve media files during development
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

**What this does:**
- In development, Django serves uploaded files directly
- In production, you'd use a web server (like Nginx) instead

### Step 5: Create Form with File Upload (`recipes/forms.py`)

```python
class RecipeForm(forms.ModelForm):
    class Meta:
        model = Recipe
        fields = ['title', 'description', 'ingredients', 'instructions', 
                  'cooking_time', 'difficulty_level', 'image', 'category']
        widgets = {
            'image': forms.FileInput(attrs={'class': 'form-control'}),
        }
```

**Key points:**
- `ModelForm` automatically creates form fields from model
- `image` field becomes a file input in HTML
- `FileInput` widget creates `<input type="file">` in HTML

### Step 6: Handle File Upload in View (`recipes/views.py`)

```python
@login_required
def recipe_create(request):
    if request.method == 'POST':
        # â­ IMPORTANT: request.FILES contains uploaded files
        form = RecipeForm(request.POST, request.FILES)
        if form.is_valid():
            recipe = form.save(commit=False)  # Don't save yet
            recipe.author = request.user  # Set the author
            recipe.save()  # Now save (this saves the file too)
            return redirect('recipes:detail', pk=recipe.pk)
    else:
        form = RecipeForm()
    return render(request, 'recipes/form.html', {'form': form})
```

**Critical points:**
1. **`request.FILES`**: Contains all uploaded files
2. **`form = RecipeForm(request.POST, request.FILES)`**: Must pass BOTH
3. **`form.save()`**: Saves the model AND the uploaded file to disk
4. **File is automatically saved** to `media/recipes/filename.jpg`

### Step 7: HTML Form with File Upload (`templates/recipes/form.html`)

```html
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <!-- enctype="multipart/form-data" is REQUIRED for file uploads -->
    
    <label>Recipe Image</label>
    {{ form.image }}  <!-- This becomes <input type="file"> -->
    
    <button type="submit">Save Recipe</button>
</form>
```

**Critical attribute:**
- **`enctype="multipart/form-data"`**: MUST be in the form tag
- Without this, files won't be uploaded (only text data would work)

### Step 8: Display Uploaded Image (`templates/recipes/detail.html`)

```html
{% if recipe.image %}
    <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
{% endif %}
```

**What `recipe.image.url` does:**
- Returns the URL path: `/media/recipes/image.jpg`
- Browser requests this URL
- Django serves the file (in development) or web server serves it (in production)

### Complete File Upload Flow:

```
1. User selects image in form
   â†“
2. Form submits with enctype="multipart/form-data"
   â†“
3. View receives request.POST and request.FILES
   â†“
4. Form validates (checks file type, size, etc.)
   â†“
5. form.save() saves Recipe model AND file to disk
   â†“
6. File saved to: media/recipes/filename.jpg
   â†“
7. Database stores: recipes/filename.jpg (relative path)
   â†“
8. When displaying: recipe.image.url â†’ /media/recipes/filename.jpg
```

### File Upload Security:

Django automatically:
- Validates file types (only images for ImageField)
- Checks file size
- Sanitizes filenames
- Prevents directory traversal attacks
- Stores files safely in `media/` folder

---

## ðŸ”„ CRUD Operations (Create, Read, Update, Delete)

### CREATE Recipe (`recipes/views.py`)

```python
@login_required  # Only logged-in users can create
def recipe_create(request):
    if request.method == 'POST':
        form = RecipeForm(request.POST, request.FILES)  # Include FILES
        if form.is_valid():
            recipe = form.save(commit=False)
            recipe.author = request.user
            recipe.save()
            return redirect('recipes:detail', pk=recipe.pk)
    else:
        form = RecipeForm()
    return render(request, 'recipes/form.html', {'form': form})
```

**URL:** `/recipes/create/`

### READ Recipe (`recipes/views.py`)

```python
def recipe_detail(request, pk):
    recipe = get_object_or_404(Recipe, pk=pk)  # Get recipe or show 404
    comments = recipe.comments.all()  # Get all comments
    return render(request, 'recipes/detail.html', {'recipe': recipe})
```

**URL:** `/recipes/<id>/`

### UPDATE Recipe (`recipes/views.py`)

```python
@login_required
def recipe_update(request, pk):
    recipe = get_object_or_404(Recipe, pk=pk)
    
    # Security: Only author can edit
    if recipe.author != request.user:
        messages.error(request, 'You can only edit your own recipes.')
        return redirect('recipes:detail', pk=pk)
    
    if request.method == 'POST':
        form = RecipeForm(request.POST, request.FILES, instance=recipe)
        if form.is_valid():
            form.save()
            return redirect('recipes:detail', pk=recipe.pk)
    else:
        form = RecipeForm(instance=recipe)  # Pre-fill with existing data
    return render(request, 'recipes/form.html', {'form': form})
```

**URL:** `/recipes/<id>/update/`

### DELETE Recipe (`recipes/views.py`)

```python
@login_required
def recipe_delete(request, pk):
    recipe = get_object_or_404(Recipe, pk=pk)
    
    if recipe.author != request.user:
        messages.error(request, 'You can only delete your own recipes.')
        return redirect('recipes:detail', pk=pk)
    
    if request.method == 'POST':
        recipe.delete()  # Deletes from database
        return redirect('recipes:home')
    
    return render(request, 'recipes/delete_confirm.html', {'recipe': recipe})
```

**URL:** `/recipes/<id>/delete/`

---

## ðŸ” Authentication System

### Custom User Model (`users/models.py`)

**Why custom?** Django's default User uses username. We changed it to email.

```python
class User(AbstractUser):
    email = models.EmailField(unique=True)
    username = None  # Remove username field
    USERNAME_FIELD = 'email'  # Use email to login
    REQUIRED_FIELDS = []
```

**Important:** Must be set BEFORE first migration!

### Registration (`users/views.py`)

```python
def register(request):
    if request.method == 'POST':
        form = UserRegistrationForm(request.POST)
        if form.is_valid():
            user = form.save()  # Create user
            login(request, user)  # Auto-login after registration
            return redirect('recipes:home')
    else:
        form = UserRegistrationForm()
    return render(request, 'users/register.html', {'form': form})
```

### Login (`users/views.py`)

```python
class CustomLoginView(LoginView):
    template_name = 'users/login.html'
    redirect_authenticated_user = True  # If already logged in, redirect
```

**Settings:** (`config/settings.py`)
```python
LOGIN_URL = 'users:login'  # Where to redirect if not logged in
LOGIN_REDIRECT_URL = 'recipes:home'  # Where to go after login
LOGOUT_REDIRECT_URL = 'recipes:home'  # Where to go after logout
```

---

## ðŸ“¡ Signals

### Signal 1: Auto-Create Profile (`users/signals.py`)

```python
@receiver(post_save, sender=User)
def create_user_profile(sender, instance, created, **kwargs):
    """Create a profile automatically when a new user is created."""
    if created:  # Only when user is first created
        Profile.objects.create(user=instance)
```

**What happens:**
1. User registers
2. User model is saved
3. Signal fires automatically
4. Profile is created automatically

### Signal 2: Welcome Email (`users/signals.py`)

```python
@receiver(post_save, sender=User)
def send_welcome_email(sender, instance, created, **kwargs):
    if created:
        send_mail(
            subject='Welcome to Recipe Sharing Platform!',
            message='...',
            from_email='noreply@recipes.com',
            recipient_list=[instance.email],
        )
```

**What happens:**
1. User registers
2. Signal fires
3. Email is sent automatically

### Signal 3: Log Recipe Creation (`recipes/signals.py`)

```python
@receiver(post_save, sender=Recipe)
def log_recipe_creation(sender, instance, created, **kwargs):
    if created:
        logger.info(f"New recipe created: {instance.title} by {instance.author.email}")
```

**Register Signals:** (`users/apps.py`)
```python
class UsersConfig(AppConfig):
    def ready(self):
        import users.signals  # Import signals when app is ready
```

---

## ðŸ“ Forms (ModelForms)

### Recipe Form (`recipes/forms.py`)

```python
class RecipeForm(forms.ModelForm):
    class Meta:
        model = Recipe
        fields = ['title', 'description', 'ingredients', 'instructions', 
                  'cooking_time', 'difficulty_level', 'image', 'category']
        widgets = {
            'title': forms.TextInput(attrs={'class': 'form-control'}),
            'description': forms.Textarea(attrs={'rows': 3}),
            'image': forms.FileInput(attrs={'class': 'form-control'}),
        }
```

**What ModelForm does:**
- Automatically creates form fields from model fields
- Handles validation based on model field types
- Saves data directly to model with `form.save()`

**Why use ModelForm:**
- Less code (don't define each field manually)
- Automatic validation
- Easy to update when model changes

---

## ðŸ§ª Testing

### Test 1: User Registration (`users/tests.py`)

```python
@pytest.mark.django_db
def test_user_registration():
    user = User.objects.create_user(
        email='test@example.com',
        password='testpass123',
        first_name='Test',
        last_name='User'
    )
    assert user.email == 'test@example.com'
    assert user.check_password('testpass123')
```

**What it tests:** Can we create a user with email?

### Test 2: User Login (`users/tests.py`)

```python
@pytest.mark.django_db
def test_user_login(client):
    user = User.objects.create_user(
        email='test@example.com',
        password='testpass123'
    )
    
    login_url = reverse('users:login')
    response = client.post(login_url, {
        'username': 'test@example.com',
        'password': 'testpass123'
    })
    
    assert response.status_code == 302  # Redirect = successful login
```

**What it tests:** Can users log in?

### Test 3: Profile Auto-Creation (`users/tests.py`)

```python
@pytest.mark.django_db
def test_profile_auto_creation():
    user = User.objects.create_user(
        email='test@example.com',
        password='testpass123'
    )
    
    # Profile should be automatically created via signal
    assert hasattr(user, 'profile')
    assert Profile.objects.filter(user=user).exists()
```

**What it tests:** Is profile created automatically via signal?

### Test 4: Recipe Creation (`recipes/tests.py`)

```python
@pytest.mark.django_db
def test_recipe_creation():
    user = User.objects.create_user(email='chef@example.com', password='testpass123')
    category = Category.objects.create(name='Desserts', slug='desserts')
    
    recipe = Recipe.objects.create(
        title='Chocolate Cake',
        description='Delicious chocolate cake',
        ingredients='Flour, Sugar, Cocoa',
        instructions='Mix and bake',
        cooking_time=60,
        difficulty_level='Medium',
        author=user,
        category=category
    )
    
    assert recipe.title == 'Chocolate Cake'
    assert recipe.author == user
```

**What it tests:** Can we create recipes?

**Run tests:**
```bash
pytest
```

---

## ðŸ› ï¸ Management Commands

### Command 1: Create Categories (`recipes/management/commands/create_categories.py`)

```python
class Command(BaseCommand):
    help = 'Creates default recipe categories'
    
    def handle(self, *args, **options):
        categories_data = [
            {'name': 'Breakfast', 'slug': 'breakfast'},
            {'name': 'Lunch', 'slug': 'lunch'},
            # ... more categories
        ]
        
        for cat_data in categories_data:
            category, created = Category.objects.get_or_create(
                slug=cat_data['slug'],
                defaults={'name': cat_data['name']}
            )
            if created:
                self.stdout.write(f'Created category: {category.name}')
```

**Usage:**
```bash
python manage.py create_categories
```

### Command 2: Create Sample Recipes (`recipes/management/commands/create_sample_recipes.py`)

```python
class Command(BaseCommand):
    help = 'Creates 10 sample recipes in the database'
    
    def handle(self, *args, **options):
        # Create categories
        # Create sample user
        # Create 10 recipes
        # Output success message
```

**Usage:**
```bash
python manage.py create_sample_recipes
```

**What it does:**
- Creates categories if they don't exist
- Creates a sample user (sample@example.com / samplepass123)
- Creates 10 sample recipes with random categories

---

## ðŸŽ¨ Frontend (Templates)

### Base Template (`templates/base.html`)

- Contains navbar, footer
- All other templates extend this
- Includes Bootstrap CSS and custom CSS

### Template Inheritance

```html
<!-- base.html -->
<html>
<body>
    <nav>...</nav>
    {% block content %}{% endblock %}
    <footer>...</footer>
</body>
</html>

<!-- recipes/list.html -->
{% extends 'base.html' %}
{% block content %}
    <!-- Recipe list here -->
{% endblock %}
```

**Why:** Don't repeat navbar/footer in every template

---

## ðŸ”— URL Routing

### Main URLs (`config/urls.py`)

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('recipes.urls')),  # Recipe URLs
    path('users/', include('users.urls')),  # User URLs
]
```

### Recipe URLs (`recipes/urls.py`)

```python
app_name = 'recipes'

urlpatterns = [
    path('', views.home, name='home'),
    path('recipes/<int:pk>/', views.recipe_detail, name='detail'),
    path('recipes/create/', views.recipe_create, name='create'),
    path('recipes/<int:pk>/update/', views.recipe_update, name='update'),
    path('recipes/<int:pk>/delete/', views.recipe_delete, name='delete'),
]
```

**URL patterns:**
- `recipes/<int:pk>/` - `<int:pk>` captures the recipe ID
- `name='detail'` - Used in templates: `{% url 'recipes:detail' recipe.pk %}`

---

## ðŸ“Š Database Relationships Summary

1. **User â†’ Recipe:** OneToMany (ForeignKey)
   - One user can create many recipes
   
2. **User â†’ Profile:** OneToOne
   - One user has one profile
   
3. **Category â†’ Recipe:** OneToMany (ForeignKey)
   - One category can have many recipes
   
4. **Recipe â†’ Comment:** OneToMany (ForeignKey)
   - One recipe can have many comments
   
5. **Recipe â†’ Rating:** OneToMany (ForeignKey)
   - One recipe can have many ratings
   
6. **Recipe â†” User (Favorites):** ManyToMany
   - Many users can favorite many recipes

---

## ðŸš€ How to Present This Project

### 1. Start with Overview
- "This is a recipe sharing platform built with Django"
- "Users can create, share, and discover recipes"

### 2. Show Project Structure
- Explain the two apps: `users` and `recipes`
- Show how Django organizes code

### 3. Explain Database Models
- Show the 6 models
- Explain relationships (OneToMany, ManyToMany, OneToOne)

### 4. **DETAILED FILE UPLOAD EXPLANATION** (Most Important!)
- Show `ImageField` in Recipe model
- Explain `upload_to='recipes/'`
- Show settings (`MEDIA_URL`, `MEDIA_ROOT`)
- Show form with `enctype="multipart/form-data"`
- Show view handling `request.FILES`
- Demonstrate uploading an image
- Show where file is saved (`media/recipes/`)
- Show how image is displayed (`recipe.image.url`)

### 5. Show CRUD Operations
- Demonstrate creating a recipe
- Show reading/viewing recipes
- Show editing (only author can edit)
- Show deleting (with confirmation)

### 6. Show Authentication
- Demonstrate registration with email
- Show login/logout
- Show protected pages (only logged-in users can create)

### 7. Show Signals
- Explain how profile is auto-created
- Show welcome email (check console in development)

### 8. Show Testing
- Run `pytest` command
- Show all tests passing

### 9. Show Management Commands
- Run `python manage.py create_sample_recipes`
- Show sample data created

### 10. Show Frontend
- Show beautiful UI
- Show responsive design
- Show forms with validation

---

## ðŸ’¡ Key Points to Emphasize

1. **File Upload:** This is the most complex part - explain it thoroughly
2. **ModelForms:** Show how they simplify form creation
3. **Relationships:** Explain why we use ForeignKey, ManyToMany, etc.
4. **Security:** Only authors can edit/delete their recipes
5. **Signals:** Automatic actions (profile creation, emails)
6. **Testing:** Show that code is tested and works

---

## â“ Common Questions & Answers

**Q: Why use Django?**
A: Django is a powerful Python framework that handles database, authentication, forms, and more automatically.

**Q: Why SQLite?**
A: It's perfect for development - no setup needed. For production, you'd use PostgreSQL.

**Q: How does file upload work?**
A: User selects file â†’ Form submits with `enctype="multipart/form-data"` â†’ View receives `request.FILES` â†’ Form saves file to `media/` folder â†’ Database stores path â†’ Display using `image.url`.

**Q: What are signals?**
A: They allow code to run automatically when something happens (like creating a user automatically creates a profile).

**Q: Why use ModelForms?**
A: They automatically create form fields from models, handle validation, and save data - much less code than manual forms.

---

Good luck with your presentation! ðŸŽ‰

